[{"content":"起因 起因是用gradio做yolov10的展示demo时，发现onnx模型推理输出总是为空，排除了输入问题以后，突然想起来上次做的一个项目也有类似的情况。于是怀疑是不是同一个原因，经过实验发现确实如此。简单记录一下这个坑。\n坑 博主习惯使用opencv处理图像，于是初始化gradio的Image模块时指定输入类型为numpy，然后交由defect_detection函数进行推理，如下：\n1 2 input_img = gr.Image(type=\u0026#34;numpy\u0026#34;, label=\u0026#39;输入图像\u0026#39;, interactive=True) input_img.upload(defect_detection, inputs=[input_img], outputs=[output_img,output_text]) 这时候理所当然的就在defect_detection函数中对输入的图像套用推理函数直接推理，例如：\n1 2 3 4 5 6 7 8 9 10 image_shape = input_img.shape[:2] blob = preprocess(input_img, input_shape) outs = onnx_model.run(None, {\u0026#39;images\u0026#39;: blob})[0][0] boxes, scores, labels = postprocess(outs, conf_thres, image_shape, input_shape) # 保存结果 for label, score, box in zip(labels, scores, boxes): label_text = f\u0026#39;{label_name[label]}: {score:.2f}\u0026#39; color = colors(label, True) cv.rectangle(input_img, (box[0], box[1]), (box[2], box[3]), color, thickness=2, lineType=cv.LINE_AA) cv.putText(input_img, label_text, (box[0], box[1] - 10), cv.FONT_HERSHEY_SIMPLEX, 0.5, color, 2) 上述代码来源于yolov10的onnx推理部分，网上搜索即可找到。 但是这个时候会发现一个问题，推理代码outs的输出部分总是为空。 这时候考虑到yolov10在训练的时候图像格式是bgr，可能是推理时输入rgb格式的图像导致推理不出结果。于是对输入图像手动进行一次格式转换，代码如下：\n1 2 3 4 5 6 7 8 9 10 11 input_img = cv.cvtColor(input_img, cv.COLOR_RGB2BGR) # 手动转换一下格式 image_shape = input_img.shape[:2] blob = preprocess(input_img, input_shape) outs = onnx_model.run(None, {\u0026#39;images\u0026#39;: blob})[0][0] boxes, scores, labels = postprocess(outs, conf_thres, image_shape, input_shape) # 保存结果 for label, score, box in zip(labels, scores, boxes): label_text = f\u0026#39;{label_name[label]}: {score:.2f}\u0026#39; color = colors(label, True) cv.rectangle(input_img, (box[0], box[1]), (box[2], box[3]), color, thickness=2, lineType=cv.LINE_AA) cv.putText(input_img, label_text, (box[0], box[1] - 10), cv.FONT_HERSHEY_SIMPLEX, 0.5, color, 2) 问题解决，但是这个时候又遇到Image模块显示有问题，看色调明显推测是通道顺序的问题，于是再进行一次格式转换，将bgr格式转为rgb格式。代码如下：\n1 2 3 4 5 6 7 8 9 10 11 12 input_img = cv.cvtColor(input_img, cv.COLOR_RGB2BGR) # 手动转换一下格式 image_shape = input_img.shape[:2] blob = preprocess(input_img, input_shape) outs = onnx_model.run(None, {\u0026#39;images\u0026#39;: blob})[0][0] boxes, scores, labels = postprocess(outs, conf_thres, image_shape, input_shape) # 保存结果 for label, score, box in zip(labels, scores, boxes): label_text = f\u0026#39;{label_name[label]}: {score:.2f}\u0026#39; color = colors(label, True) cv.rectangle(input_img, (box[0], box[1]), (box[2], box[3]), color, thickness=2, lineType=cv.LINE_AA) cv.putText(input_img, label_text, (box[0], box[1] - 10), cv.FONT_HERSHEY_SIMPLEX, 0.5, color, 2) input_img = cv.cvtColor(input_img, cv.COLOR_BGR2RGB) # 手动转换一下格式 显示的问题解决。\n总结 使用gradio的Image模块时，在设置输入格式为numpy的情况下，如果需要对输入的图像进行处理，注意gradio默认图像的通道顺序是rgb。包括显示的通道顺序也是rgb。如果程序需要处理其他格式的图像，则需要手动对图像进行格式转换。\n","date":"2024-08-31T18:07:50+08:00","image":"https://laonafahaodange.github.io/p/%E5%AE%9E%E8%B7%B5%E5%85%B3%E4%BA%8Egradio-image%E6%A8%A1%E5%9D%97%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/cover_hu983473666233912352.jpg","permalink":"https://laonafahaodange.github.io/p/%E5%AE%9E%E8%B7%B5%E5%85%B3%E4%BA%8Egradio-image%E6%A8%A1%E5%9D%97%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/","title":"【实践】关于gradio Image模块的一些坑"},{"content":"随笔 得休三天小假期，不想在中班的时候做体检今天就抽空去做了个体检。\n作息原因感觉身体状态有些下降了，想恢复一下身体的状态。\n房间自搬家过来一个月了也还没打扫，坐在电脑前看着桌面，桌面一堆文件乱放也乱乱的。\n好多东西都好乱，还是整理一下吧，为了更好地出发。\n","date":"2024-08-30T00:00:00Z","image":"https://laonafahaodange.github.io/p/%E9%9A%8F%E7%AC%942024.08.30/cover_hu696693175984392796.jpg","permalink":"https://laonafahaodange.github.io/p/%E9%9A%8F%E7%AC%942024.08.30/","title":"【随笔】2024.08.30"},{"content":"链接备份 文献 中国知网高校/机构外部访问系统：https://fsso.cnki.net/\nPapers With Code：https://paperswithcode.com/\n竞赛 华为云大赛平台：https://competition.huaweicloud.com/competitions\n百度AI飞浆大赛：https://aistudio.baidu.com/competition\nCodalab：https://codalab.lisn.upsaclay.fr/\nKaggle：https://www.kaggle.com/\n工具 图床：https://sm.ms/](https://sm.ms/\nHyperAI超神经：https://hyper.ai/\n文档 Hugo Stack Theme：https://stack.jimmycai.com/\n","date":"2024-08-30T00:00:00Z","image":"https://laonafahaodange.github.io/p/%E6%9D%82%E9%A1%B9%E9%93%BE%E6%8E%A5%E5%A4%87%E4%BB%BD/cover_hu13203804621816008716.jpg","permalink":"https://laonafahaodange.github.io/p/%E6%9D%82%E9%A1%B9%E9%93%BE%E6%8E%A5%E5%A4%87%E4%BB%BD/","title":"【杂项】链接备份"},{"content":"随笔 明天就要考试了今天还在搭博客。真的是越到考试越浪~\n第一篇博客，以后慢慢往这里填充内容吧。\n","date":"2024-08-28T00:00:00Z","image":"https://laonafahaodange.github.io/p/%E9%9A%8F%E7%AC%942024.08.28/cover_hu17883744800625510187.jpg","permalink":"https://laonafahaodange.github.io/p/%E9%9A%8F%E7%AC%942024.08.28/","title":"【随笔】2024.08.28"}]